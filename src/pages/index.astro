---
import GithubCalendar from '@/components/bento/GithubCalendar.tsx'
import Marquee from '@/components/bento/Marquee.tsx'
import SpotifyPresence from '@/components/bento/SpotifyPresence.tsx'
import WakatimeGraph from '@/components/bento/WakatimeGraph.tsx'
import Link from '@/components/Link.astro'
import PageHead from '@/components/PageHead.astro'
import { badgeVariants } from '@/components/ui/badge'
import { buttonVariants } from '@/components/ui/button'
import { NAV_LINKS, SOCIAL_LINKS } from '@/consts'
import Layout from '@/layouts/Layout.astro'
import { getAllPosts } from '@/lib/data-utils'
import { cn } from '@/lib/utils'
import { Icon } from 'astro-icon/components'

// const blog = await getRecentPosts(SITE.featuredPostCount)
const latestPost = await getAllPosts().then((posts) => posts.at(0))
---

<Layout class="max-w-5xl">
  <PageHead slot="head" title="home" />
  <section
    class={cn(
      'mx-auto grid min-w-xs sm:has-[[data-trigger]:hover]:*:first:[&_[data-overlay]]:opacity-0 mt-[-55px]',

      // Mobile
      'max-w-sm grid-cols-2 [grid-template-areas:"a_a""b_b""c_c""d_e""f_f""g_g"]',
      'sm:max-w-2xl sm:grid-cols-2 sm:[grid-template-areas:"a_a""b_b""c_c""e_d""f_f""g_g"]',
      'lg:max-w-5xl lg:grid-cols-3 lg:[grid-template-areas:"b_c_c""a_d_e""a_f_f""g_g_g"]',

      // XL (original)
      'xl:max-w-7xl xl:grid-cols-4 xl:[grid-template-areas:"b_a_a_a""b_c_c_d""e_c_c_d""e_f_f_f""g_g_g_g"]',
    )}
  >
    <div
      class="aspect-square p-2 duration-300 ease-in-out [grid-area:a] sm:aspect-[3/1] lg:aspect-[3/1] xl:aspect-[3/1]"
    >
      <div class="bg-primary-foreground/70 hover:bg-primary-foreground border">
        <div class="flex flex-col space-y-1.5 p-6 pb-3">
          <div
            class="mb-5 flex flex-col items-center justify-between gap-4 sm:flex-row lg:flex-col xl:flex-row"
          >
            <h3 class="text-3xl leading-none font-medium">hey there!</h3>
            <nav class="flex items-center gap-2">
              {
                NAV_LINKS.map((item) => (
                  <Link
                    href={item.href}
                    class={
                      badgeVariants({
                        variant: 'muted',
                      }) + ' size-7!important'
                    }
                  >
                    {item.label}
                  </Link>
                ))
              }
            </nav>
          </div>
          <p class="text-muted-foreground text-sm">
            I&rsquo;m Mark, an undergrad IT student from Polytechnic University
            of the Philippines - San Juan Campus.
          </p>
        </div>
        <div class="p-6 pt-0">
          <div class="text-muted-foreground mb-2 text-sm">
            I’m passionate about web development and UI/UX design, and I am
            currently trying to expand into other areas of IT as well.
          </div>
          <div class="text-muted-foreground mb-2 text-sm">
            This website serves as my personal online portfolio, a space where I
            document my growth, showcase my work, and reflect on my journey.
            Here, you’ll find my academic and personal projects, writings,
            creative experiments, and a few multimedia pieces along the way.
          </div>
          <div class="text-muted-foreground mb-2 text-sm">
            This acts as my corner of the internet, something that represents
            me. I made this site as close to my preference and personality as
            possible. So, feel free to look around and get to know me better!
          </div>
          <div class="text-muted-foreground mb-2 text-sm">
            If you have any message, suggestions, or inquiries, don’t hesitate
            to drop it in my
            <Link
              href={SOCIAL_LINKS.find((link) => link.label === 'Inbox')?.href ||
                '#'}
              class="text-foreground"
              target="_self"
              underline>inbox</Link
            >.
          </div>
        </div>
      </div>
    </div>
    <div
      class="aspect-square p-2 [grid-area:b] sm:aspect-square xl:aspect-[1/2]"
    >
      <div class="bg-muted size-full border">
        <div
          class="size-full bg-[url('/static/silhouette.jpg')] bg-cover bg-center bg-no-repeat"
        >
        </div>
      </div>
    </div>
    <div class="aspect-square p-2 [grid-area:c] sm:aspect-[2/1]">
      <div
        data-trigger
        class="bg-primary-foreground/70 hover:bg-primary-foreground relative size-full border"
      >
        <div class="absolute size-full">
          <div
            class="absolute size-full transition-opacity duration-200 sm:opacity-0 sm:hover:opacity-100"
          >
            <p
              class="text-foreground/80 bg-background absolute top-[50%] left-[38%] hidden -translate-y-1/2 border p-2 text-xs text-pretty sm:block"
            >
              My GitHub calendar!
            </p>
          </div>
        </div>
        <div class="flex size-full items-center justify-center p-8">
          <GithubCalendar username="pulge" client:load />
        </div>
      </div>
    </div>
    <div class="aspect-square p-2 [grid-area:e]">
      <div
        data-trigger
        class="bg-primary-foreground/70 hover:bg-primary-foreground size-full border"
      >
        <div class="group/spotify relative size-full">
          <div
            class="absolute size-full transition-opacity sm:opacity-0 sm:group-hover/spotify:opacity-100"
          >
          </div>
          <div class="flex size-full items-center justify-center">
            <SpotifyPresence client:load />
          </div>
        </div>
      </div>
    </div>
    <div class="aspect-square p-2 [grid-area:d]">
      <div
        class="bg-primary-foreground/70 hover:bg-primary-foreground size-full border"
      >
        <div
          class="group/github relative flex size-full items-center justify-center"
        >
          <Icon
            name="mdi:github"
            class="text-primary size-1/2 sm:size-24"
            aria-hidden="true"
          />
          <Link
            href={SOCIAL_LINKS.find((link) => link.label === 'GitHub')?.href ||
              '#'}
            title="Visit my GitHub profile"
            aria-label="Visit my GitHub profile"
            external
            class="bg-border/50 text-primary ring-ring group/github-link absolute end-0 bottom-0 m-3 rounded-full p-3 transition-[box-shadow] duration-300 hover:ring-2 focus-visible:ring-2"
          >
            <Icon
              name="lucide:move-up-right"
              class="transition-transform duration-300 group-hover/github-link:rotate-12"
              size={16}
            />
          </Link>
        </div>
      </div>
    </div>
    <div
      class="my-4 flex aspect-[6/1] items-center [grid-area:f] sm:m-0 xl:items-start"
    >
      <div class="overflow-hidden sm:mt-4">
        <Marquee client:load />
      </div>
    </div>
    <!-- <div class="aspect-square p-2 [grid-area:j]">
      <div class="bg-muted size-full border">
        <WakatimeGraph client:load />
      </div>
    </div> -->
    <div class="aspect-[7/2] p-2 [grid-area:g] lg:aspect-[5/1]">
      <div
        data-trigger
        class="bg-primary-foreground/70 hover:bg-primary-foreground size-full overflow-hidden border"
      >
        <div
          class="group/blog relative size-full sm:bg-[url('/static/bento/blog-background.png')]"
        >
          <!-- <div
            class="absolute size-full transition-opacity duration-200 sm:bg-[url('/static/bento/blog-foreground.png')] sm:opacity-0 sm:group-hover/blog:opacity-100"
          >
            <p
              class="text-foreground/80 bg-background absolute top-[55%] right-5 hidden -translate-y-1/2 border p-2 text-xs text-pretty shadow-sm sm:block"
            >
              Read my latest<br /> blog post!
            </p>
          </div> -->

          {
            latestPost && (
              <div class="flex h-full flex-col p-3 sm:p-6">
                <div class="flex h-full flex-1 items-center justify-center gap-4 sm:items-start sm:justify-start">
                  <Link
                    href={`/blog/${latestPost.id}`}
                    class="group/img h-full w-full overflow-hidden border sm:min-h-0 sm:flex-1"
                  >
                    <img
                      src={latestPost.data.image?.src ?? '#'}
                      alt={`Featured image for the latest post: ${latestPost.data.title}`}
                      class="h-full w-full border object-cover opacity-20 transition-transform duration-300 group-hover/img:scale-105 sm:opacity-100"
                    />
                  </Link>
                  <div class="hidden h-full w-[70%] flex-col overflow-hidden sm:flex">
                    <div class="flex min-w-0 flex-1 flex-col justify-center">
                      {/* <h3 class="mb-1 text-2xl font-bold">Latest Post</h3> */}
                      <Link href={`/blog/${latestPost.id}`} class="group/title">
                        <h3 class="text-foreground group-hover/title:text-primary mb-2 line-clamp-2 hidden text-lg font-semibold transition-colors sm:block sm:text-xl">
                          {latestPost.data.title}
                        </h3>
                      </Link>
                      <p class="text-muted-foreground line-clamp-2 hidden text-sm sm:line-clamp-2 sm:block sm:text-base">
                        {latestPost.data.description}
                      </p>
                    </div>
                  </div>
                  <div class="border-border/50 absolute top-0 right-0 z-10 flex h-full w-full flex-row flex-row-reverse items-center justify-evenly py-3 sm:top-0 sm:right-3 sm:right-5 sm:bottom-6 sm:flex-col sm:items-end sm:justify-between sm:px-0">
                    <Link
                      href={`/${latestPost.collection}`}
                      class={
                        'sm:' +
                        buttonVariants({ variant: 'ghost', size: 'sm' }) +
                        ' group/link bg-foreground/70 text-background sm:text-foreground z-10 inline-flex items-center text-xs sm:bg-transparent sm:text-sm'
                      }
                    >
                      see all {`${latestPost.collection}`}
                      <span class="ml-1.5 transition-transform group-hover/link:translate-x-1">
                        &rarr;
                      </span>
                    </Link>

                    <Link
                      href={
                        latestPost.collection === 'coding'
                          ? `/${latestPost.collection}`
                          : `/${latestPost.collection}/${latestPost.id}`
                      }
                      title={`Read latest blog post: ${latestPost.data.title}`}
                      aria-label={`Read latest blog post: ${latestPost.data.title}`}
                      class="bg-border/50 text-primary ring-ring group/btn relative z-10 flex items-center gap-1 rounded-full p-2 transition-all duration-300 hover:shadow-lg hover:ring-2 focus-visible:ring-2 sm:p-3"
                    >
                      <p class="text-xs sm:hidden">latest post</p>
                      <Icon
                        name="lucide:move-up-right"
                        class="transition-transform duration-300 group-hover/btn:scale-110 group-hover/btn:rotate-12"
                        size={16}
                      />
                    </Link>
                  </div>
                </div>
              </div>
            )
          }
        </div>
      </div>
    </div>
  </section>
</Layout>
